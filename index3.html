<!DOCTYPE html>
<html>
  <head>
    <title>Leaflet Polygon Drawing</title>
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <!-- Leaflet Draw CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"
    />

    <style>
      #map {
        height: 600px;
        width: 100%;
      }
      .coordinate-display {
        background-color: white;
        padding: 5px;
        border: 2px solid #ccc;
        border-radius: 5px;
        font-size: 12px;
      }
      #warning-message {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #ff4444;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 1000;
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="warning-message">You're viewing outside of Iran's territory</div>
    <button id="show-btn">Show Saved Polygon</button>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Leaflet Draw JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

    <script>
      // Initialize the map centered on Iran
      const map = L.map("map").setView([32.4279, 53.688], 5);

      // Add the tile layer (OpenStreetMap)
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap contributors",
      }).addTo(map);

      // Define Iran's boundaries
      const iranBounds = {
        north: 39.8,
        south: 25.0,
        west: 44.0,
        east: 63.3,
      };

      // Function to check if coordinates are within Iran
      function isWithinIran(lat, lng) {
        return (
          lat >= iranBounds.south &&
          lat <= iranBounds.north &&
          lng >= iranBounds.west &&
          lng <= iranBounds.east
        );
      }

      // Initialize feature group for drawn items
      const drawnItems = new L.FeatureGroup();
      map.addLayer(drawnItems);

      // Initialize drawing control
      const drawControl = new L.Control.Draw({
        draw: {
          polygon: true,
          marker: false,
          circle: false,
          rectangle: false,
          polyline: false,
          circlemarker: false,
        },
        edit: {
          featureGroup: drawnItems,
          remove: true,
        },
      });
      map.addControl(drawControl);

      // Array to store saved polygons
      let savedPolygons = [];

      // Function to redraw saved polygons
      function redrawSavedPolygons() {
        drawnItems.clearLayers();

        savedPolygons.forEach((coordinates) => {
          const leafletCoords = coordinates.map((coord) => [
            coord[1],
            coord[0],
          ]);
          const polygon = L.polygon(leafletCoords, {
            color: "red",
            weight: 2,
          });
          drawnItems.addLayer(polygon);
        });
      }

      // Handle newly drawn polygons
      map.on("draw:created", function (e) {
        const layer = e.layer;
        drawnItems.addLayer(layer);

        // Save coordinates
        const coordinates = layer
          .getLatLngs()[0]
          .map((point) => [point.lng, point.lat]);
        savedPolygons.push(coordinates);

        console.log("Polygon created:", JSON.stringify(coordinates));
      });

      // Handle edited polygons
      map.on("draw:edited", function (e) {
        savedPolygons = [];
        e.layers.eachLayer(function (layer) {
          const updatedCoordinates = layer
            .getLatLngs()[0]
            .map((point) => [point.lng, point.lat]);
          savedPolygons.push(updatedCoordinates);
        });

        console.log("Polygons updated:", JSON.stringify(savedPolygons));
      });

      // Handle deleted polygons
      map.on("draw:deleted", function (e) {
        e.layers.eachLayer(function (layer) {
          const deletedCoords = layer
            .getLatLngs()[0]
            .map((point) => [point.lng, point.lat]);
          savedPolygons = savedPolygons.filter(
            (coords) => JSON.stringify(coords) !== JSON.stringify(deletedCoords)
          );
        });

        console.log("Polygons after deletion:", JSON.stringify(savedPolygons));
      });

      // Monitor map movement for Iran boundaries
      map.on("moveend", function () {
        const center = map.getCenter();
        const warning = document.getElementById("warning-message");

        if (!isWithinIran(center.lat, center.lng)) {
          warning.style.display = "block";
        } else {
          warning.style.display = "none";
        }
      });

      // Example of how to redraw a specific polygon
      function redrawPolygon(coordinates) {
        const leafletCoords = coordinates.map((coord) => [coord[1], coord[0]]);
        drawnItems.clearLayers();

        const polygon = L.polygon(leafletCoords, {
          color: "red",
          weight: 2,
        });

        drawnItems.addLayer(polygon);
        map.fitBounds(polygon.getBounds());
      }

      // Example usage:
      // const sampleCoordinates = [[51.123, 35.456], [51.789, 35.789], [51.456, 35.123]];
      // redrawPolygon(sampleCoordinates);

      // Add coordinate display
      const coordDisplay = L.control({ position: "bottomleft" });
      coordDisplay.onAdd = function (map) {
        const div = L.DomUtil.create("div", "coordinate-display");
        div.innerHTML = "Move mouse over map";
        return div;
      };
      coordDisplay.addTo(map);

      // Update coordinates on mouse move
      map.on("mousemove", function (e) {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);
        document.querySelector(
          ".coordinate-display"
        ).innerHTML = `Lat: ${lat}<br>Lng: ${lng}`;
      });

      // Optional: Save coordinates on click
      map.on("click", function (e) {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);
        console.log(`Clicked at: [${lng}, ${lat}]`);
      });

      const showBtn = document.getElementById("show-btn");
      showBtn.addEventListener("click", function () {
        const savedCoordinates = [
          [48.198120184242725, 39.598916159397305],
          [48.031128030270345, 39.757879992021756],
          [47.85974124446512, 39.71563815091526],
          [47.73889163509012, 39.65603320747464],
          [47.64166273176671, 39.59129713723961],
          [47.464782614260926, 39.52141599148208],
          [47.336242608726025, 39.455706016688325],
          [47.26263424381614, 39.378045847591615],
          [47.10003655403853, 39.311775459961886],
          [47.02423095703126, 39.25522604148327],
          [46.99237050488591, 39.19565113786431],
          [46.87316894531251, 39.176065443682155],
          [46.69244388118387, 39.05161173849118],
          [46.60345455631614, 38.970940724186086],
          [46.53314212337137, 38.912834846693684],
          [46.4117431640625, 38.92822028919069],
          [46.268371548503644, 38.9312117963282],
          [46.18103027343751, 38.897018458604876],
          [46.11621100455523, 38.904285777743624],
          [46.02172851562501, 38.91112508918328],
          [45.91131605207921, 38.92437429023245],
          [45.81463616341353, 38.96239872312871],
          [45.684997625648975, 38.991864312434906],
          [45.49493411555886, 39.027718840211605],
          [45.4669189453125, 39.0806136754648],
          [45.41802981868387, 39.132190775931036],
          [45.356506314128644, 39.20757018972931],
          [45.22247306071222, 39.27351396104329],
          [44.989013671875, 39.58198360264141],
          [44.88519282080234, 39.6674508682688],
          [44.698974592611194, 39.806004066747676],
          [44.565490689128644, 39.83216276129975],
          [44.421569807454944, 39.74478780775429],
          [44.36828613281251, 39.61626788999703],
          [44.34631347656251, 39.45061624351607],
          [44.14910892024636, 39.48538924006254],
          [43.92993170768023, 39.426010163608126],
          [43.97827148437501, 39.26203141523749],
          [44.13098137825728, 39.11557092906142],
          [44.12219244986773, 38.955991546397534],
          [44.205688275396824, 38.805470223177466],
          [44.18151855468751, 38.685509760012025],
          [44.222167767584324, 38.56878398056322],
          [44.23315443098546, 38.41572331236183],
          [44.32104505598546, 38.27182610427897],
          [44.29138183593751, 38.165659037469815],
          [44.21997070312501, 38.09911816856171],
          [44.15734849870206, 37.880056455214756],
          [44.386962689459324, 37.73075591886803],
          [44.52758789062501, 37.70903014866536],
          [44.49792467057705, 37.5419640647204],
          [44.57153320312501, 37.413800350662896],
          [44.68908704817296, 37.28803931859296],
          [44.65832512825728, 37.155938651244625],
          [44.751708917319775, 37.02185263858096],
          [44.76049818098546, 36.79960867136159],
          [45.09228542447091, 36.19818509448108],
          [45.94042975455523, 35.577363328442985],
          [46.14587405696512, 35.18278813800229],
          [46.133789028972394, 35.11811132546162],
          [46.07281495817006, 35.09114740496286],
          [45.971191339194775, 35.119908570996834],
          [45.88275144807995, 35.074964853989556],
          [45.85034172981978, 35.017400743002746],
          [45.85198977962137, 34.95079162575142],
          [45.78112799674273, 34.92197103616377],
          [45.77865600585938, 34.901925681746064],
          [45.79074095003307, 34.87342583142203],
          [45.78744505997748, 34.860918836886334],
          [45.77824401436374, 34.85088934795884],
          [45.76602173270658, 34.84243652745765],
          [45.750365138119385, 34.828966634908895],
          [45.75004112713941, 34.8289093901787],
          [45.74972784499551, 34.82884069642302],
          [45.74958729717765, 34.82880987229533],
          [45.74941349022994, 34.828798423303816],
          [45.749086260730124, 34.82878873566333],
          [45.74865710728773, 34.828786974310695],
          [45.748264432149895, 34.82877992889973],
          [45.74776983257835, 34.828865355810954],
          [45.746592879295356, 34.829103141412666],
          [45.74546313298925, 34.82934797175791],
          [45.74388277524122, 34.82968086971238],
          [45.74238073819288, 34.82999086853677],
          [45.74088513851166, 34.830314076296816],
          [45.74013948440552, 34.83047700072211],
          [45.739395976197564, 34.83062671477466],
          [45.73898613452912, 34.830716543048645],
          [45.738622427052185, 34.830794922510705],
          [45.737861752477336, 34.830940232718795],
          [45.73745727539063, 34.83103710593644],
          [45.73705601698749, 34.83111636581196],
          [45.736700892448425, 34.831197386912336],
          [45.736532449918755, 34.83122997158113],
          [45.73643159859785, 34.83137616167016],
          [45.7362899778309, 34.8316315531433],
          [45.736160159176514, 34.83189927302947],
          [45.736154794758484, 34.832124720767936],
          [45.73613226413727, 34.832259460892445],
          [45.73611295203592, 34.83239596193759],
          [45.73611402498501, 34.83252365625881],
          [45.73609471321107, 34.832655753624124],
          [45.73607540110971, 34.83291554449096],
          [45.73599171631942, 34.833448333365375],
          [45.73595738424048, 34.83403924054954],
          [45.736117243832275, 34.83452711019806],
          [45.73620736598969, 34.835036111855054],
          [45.73620951156045, 34.835605872895925],
          [45.73620522041894, 34.8358700575244],
          [45.736154794758484, 34.83613864436096],
          [45.73607432848804, 34.83667141237824],
          [45.735914468568815, 34.83773605742161],
          [45.73612368087198, 34.83825120346652],
          [45.736354351174676, 34.83879452457724],
          [45.736351132327414, 34.838922209041634],
          [45.73637795441755, 34.839056937907415],
          [45.73643481744512, 34.83938363246531],
          [45.73646485805512, 34.83967422217462],
          [45.73653459548951, 34.839968333286684],
          [45.73658877614435, 34.84027389051023],
          [45.736642956799194, 34.84057944659949],
          [45.73670142892298, 34.84077140930934],
          [45.73675990104676, 34.84096337157152],
          [45.736919760965975, 34.84145384164168],
          [45.73703026784643, 34.841947831200294],
          [45.73710107790249, 34.84221815886938],
          [45.73715901387914, 34.84244357868677],
          [45.73725986487262, 34.84293492056241],
          [45.73731672757276, 34.84343858704921],
          [45.73739290237427, 34.84394489199643],
          [45.73735535144806, 34.84452867964025],
          [45.7373982667923, 34.84509749454554],
          [45.73716330534808, 34.84545586360117],
          [45.73704957962036, 34.845646934341275],
          [45.73697769661521, 34.84585913680885],
          [45.736917614904094, 34.845970961198574],
          [45.7368714808763, 34.84608982941706],
          [45.736902594435385, 34.84644731346261],
          [45.707107535563416, 34.83680087159624],
          [45.67456056363881, 34.8025276659169],
          [45.625671353191144, 34.728069793204206],
          [45.68005372770131, 34.655351983480124],
          [45.71246336214245, 34.5726203206698],
          [45.6163329910487, 34.5798569453797],
          [45.56030273437501, 34.602467466122036],
          [45.4998779296875, 34.60291950338204],
          [45.492736799642444, 34.50519858548196],
          [45.449340837076306, 34.47803363061344],
          [45.419677700847394, 34.44044051574827],
          [45.4339599609375, 34.391952344471406],
          [45.4680175613612, 34.34887853251764],
          [45.52789301611483, 34.32120897888257],
          [45.54931640625001, 34.280822175467534],
          [45.5284423660487, 34.22088697429016],
          [45.536682112142444, 34.15954545771161],
          [45.44549563899637, 34.11180455556901],
          [45.38891603238881, 34.027624047624265],
          [45.36145021207631, 33.98664113654014],
          [45.3911132644862, 33.944271359927995],
          [45.492736799642444, 33.90370418803777],
          [45.56030273437501, 33.81703551598247],
          [45.61853030696512, 33.70560575679188],
          [45.727020297199495, 33.62514023770045],
          [45.78167726285756, 33.57435342321652],
          [45.83990475162864, 33.59860671494885],
          [45.89263916015625, 33.586709704527095],
          [45.88220218196512, 33.5459730276919],
          [45.83276362158359, 33.50750730541672],
          [45.86242675781251, 33.4520682165952],
          [45.98382563330233, 33.46031760968741],
          [46.06567382812501, 33.33328200515704],
          [46.13928236067296, 33.250172902093894],
          [46.16455078125001, 33.18491593643127],
          [46.07336422428489, 33.15732787226159],
          [46.0008544754237, 33.120530306596706],
          [46.03601069189608, 33.080956048865346],
          [46.099731428548694, 33.04734945795324],
          [46.05908204801381, 32.997607223606316],
          [46.07666015625001, 32.93492866908233],
          [46.94018544629216, 32.48937703212695],
          [47.34448235481978, 32.37161061306319],
          [47.44665540754796, 32.1170096183456],
          [47.69384779036046, 31.7916875041879],
          [47.56201185286046, 31.171449901458253],
          [47.652099207043655, 30.987027960280326],
          [47.874023169279106, 30.868282572465684],
          [47.88061536848546, 30.520627748381255],
          [48.11132825911046, 30.207810284047294],
          [48.54418952018023, 29.813957347197746],
          [48.988037109375, 29.67850809103362],
          [49.43627983331681, 29.6880527498568],
          [49.78344719856978, 29.292148278055468],
          [50.62280260026455, 28.300511250506066],
          [51.09301764518023, 27.73410553391127],
          [51.53686523437501, 27.414686725859248],
          [52.20703125000001, 26.99649245329326],
          [52.83105522394181, 26.561015484214433],
          [53.740722388029106, 26.13571361317392],
          [53.894530981779106, 25.72865299239623],
          [54.38232421875001, 25.46311452925943],
          [54.861327856779106, 25.375794574606218],
          [55.69628946483135, 25.954093177712007],
          [56.47851616144181, 26.344621405431507],
          [57.322265356779106, 25.252645229787984],
          [58.84716823697091, 25.01791940182045],
          [61.6816395521164, 24.631041557302634],
          [62.151854932308204, 26.040990593288793],
          [63.47900390625001, 26.80838328010387],
          [63.39990288019181, 27.20774000911614],
          [63.03955078125001, 27.5238608866365],
          [63.118651807308204, 28.219225410086157],
          [61.79589763283731, 28.92163128242129],
          [61.154297143220916, 29.86351216511732],
          [62.11669921875001, 30.82300779011932],
          [61.9936515390873, 31.466153715024294],
          [61.05322346091272, 31.672083485607402],
          [61.11914142966272, 32.39851580247402],
          [60.780761986970916, 33.111789434774195],
          [61.14990234375001, 33.51941550672608],
          [60.79833984375001, 34.03081055602283],
          [61.409179419279106, 35.02639787558435],
          [61.426757276058204, 36.65431820737673],
          [60.51269531250001, 36.88313564799382],
          [59.70410183072091, 37.366664419958255],
          [59.18115288019181, 37.76029288556525],
          [58.39837649837137, 37.66382019997238],
          [58.26379397884012, 37.69903420794415],
          [58.24237050488591, 37.78547658776815],
          [58.05230716243387, 37.83321560459699],
          [57.95837402343751, 37.871818110003275],
          [57.84027099609376, 37.90433263801684],
          [57.66998291015626, 37.94982885148694],
          [57.54968248307706, 37.95286091815649],
          [57.45794691145421, 37.97278279539033],
          [57.3870849609375, 38.01477452974952],
          [57.39971917122603, 38.0636623674058],
          [57.40521233528853, 38.118135988248696],
          [57.32336439192296, 38.1976118198337],
          [57.234924416989095, 38.31450802514019],
          [57.131103482097394, 38.28778078146904],
          [57.064636163413525, 38.22739284627912],
          [56.95202630013228, 38.27786343750144],
          [56.81250013411046, 38.319248845263566],
          [56.6455078125, 38.31493908736258],
          [56.49609368294478, 38.319248845263566],
          [56.33789028972388, 38.27958827885397],
          [56.26977525651456, 38.21746712569885],
          [56.268676556646824, 38.12591462924157],
          [56.11816406250001, 38.13282829571732],
          [55.85009772330523, 38.167386541086714],
          [55.65673828125001, 38.169977917443596],
          [55.46667460352184, 38.14233353435869],
          [55.07885735481978, 38.00828267416717],
          [54.78112796321512, 37.759424337052494],
          [54.68115214258434, 37.534123613787614],
          [54.207641500979676, 37.371903105458046],
          [53.90551747754216, 37.391109021834815],
          [53.61328125000001, 37.3998373485702],
          [53.62756334245206, 37.27317845016766],
          [53.66931159049273, 37.13667292618605],
          [53.39355468750001, 37.11039353847056],
          [53.11669941991568, 37.0692040503514],
          [52.80358873307705, 37.00167536970546],
          [52.54980482161046, 36.96218253246098],
          [52.31030266731978, 36.88181755936464],
          [52.13946539908648, 36.84094385126272],
          [51.83953860774637, 36.801807656957635],
          [51.53521735221148, 36.89851229304378],
          [51.21551513671875, 36.936281775793205],
          [50.956787075847394, 37.05254672418141],
          [50.71618655696512, 37.17344871200958],
          [50.618957486003644, 37.22639200509925],
          [50.536560108885176, 37.29940132619516],
          [50.4942626785487, 37.39940091808612],
          [50.41900634765625, 37.524103997383726],
          [50.29541015625001, 37.58898932239186],
          [50.14709472656251, 37.62684928319243],
          [49.98339850455523, 37.6999034650438],
          [49.7850950807333, 37.67729913640427],
          [49.481872525066144, 37.6999034650438],
          [49.26379401236773, 37.83321560459699],
          [49.22094739973546, 37.9610900598349],
          [49.192932061851025, 38.10171170620682],
          [49.17590338736773, 38.27398229593566],
          [49.143631006591036, 38.406361424158305],
          [49.1433563316241, 38.43648715459962],
          [49.1444549895823, 38.44939436593294],
          [49.1407470451668, 38.462299252611615],
          [49.06439205631614, 38.46068629262944],
          [48.945465087890625, 38.45681495946778],
          [48.87240603100509, 38.45896571300021],
          [48.79165649414063, 38.4660627676699],
          [48.724914542399354, 38.42648251239284],
          [48.65377804264427, 38.41357113884862],
          [48.61724853515625, 38.42755834917828],
          [48.59252929687501, 38.4735891265839],
          [48.53100587613881, 38.53763924025304],
          [48.48156739957631, 38.57994964784033],
          [48.468109080567956, 38.627385106754026],
          [48.40740968473256, 38.62180611319419],
          [48.369506886228926, 38.621591546741236],
          [48.33215327002109, 38.62008936713233],
          [48.306335499510176, 38.649053322140226],
          [48.27392578125001, 38.67800554026613],
          [48.275848338380456, 38.718947581615915],
          [48.22668462060392, 38.7530123043236],
          [48.170928955078125, 38.77442837007637],
          [48.12478636857123, 38.78770306962082],
          [48.08605958707631, 38.80996481592422],
          [48.03771972656251, 38.834466087118116],
          [48.025222780415795, 38.85297018617142],
          [48.022888179402806, 38.87906026100904],
          [48.01588440779598, 38.90439268578113],
          [48.03497314453126, 38.896590830001344],
          [48.05419921875, 38.89958342598271],
          [48.08441162109376, 38.91165939690589],
          [48.09306335868315, 38.93879610234948],
          [48.1452484172769, 38.938155190845215],
          [48.17189025459812, 38.947874967304806],
          [48.217071541585035, 38.946486523363575],
          [48.26348880305886, 38.95802057445024],
          [48.30331420060248, 38.975318115164455],
          [48.35494995117188, 39.02302463771705],
          [48.371704202145345, 39.08956785484934],
          [48.31182857975364, 39.150084767029014],
          [48.234924282878644, 39.1999082020942],
          [48.176147360354676, 39.261180828320235],
          [48.23822021484376, 39.31135042112233],
          [48.33874505013228, 39.331323223661556],
          [48.39532474055887, 39.35893583679117],
          [48.410156182944775, 39.39715062840465],
        ]; // Your saved coordinates
        redrawPolygon(savedCoordinates);
      });
    </script>
  </body>
</html>
